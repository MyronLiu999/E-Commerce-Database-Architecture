// MongoDB Data Generator for E-Commerce Database
// Based on database_design.md specifications
// Compatible with DataGrip MongoDB Console

// Switch to ecommerce_catalog database
use('ecommerce_catalog');

// Drop existing collections (optional - uncomment if needed)
// db.product_specs.drop();

// ====================
// PRODUCT SPECIFICATIONS COLLECTION
// Collection: product_specs
// ====================

// Generated by AI
db.product_specs.insertMany([
    // ==================== fashion (1-500) ====================
    // Comment: Women's silk blouse with slim fit, V-neck design, suitable for spring occasions
    {
        "spec_id": "1_XS_pink",
        "product_id": 1,
        "attributes": {
            "size": "XS",
            "color": "pink",
            "material": "silk",
            "fit": "slim",
            "neckline": "V-neck",
            "pattern": "solid",
            "season": "spring",
            "sleeve": "short"
        }
    },
    // Comment: Women's silk blouse in larger size (M) with white color, same design as XS version
    {
        "spec_id": "1_M_white",
        "product_id": 1,
        "attributes": {
            "size": "M",
            "color": "white",
            "material": "silk",
            "fit": "slim",
            "neckline": "V-neck",
            "pattern": "solid",
            "season": "spring",
            "sleeve": "short"
        }
    },
    // Comment: Men's cotton denim jeans with straight fit, all-season wearability
    {
        "spec_id": "2_L_denim",
        "product_id": 2,
        "attributes": {
            "size": "L",
            "color": "denim blue",
            "material": "cotton",
            "fit": "straight",
            "neckline": "round",
            "pattern": "denim weave",
            "season": "all",
            "sleeve": "none"
        }
    },
    // Comment: Men's cotton jeans in XXL size, black color, maintains straight fit and denim material
    {
        "spec_id": "2_XXL_black",
        "product_id": 2,
        "attributes": {
            "size": "XXL",
            "color": "black",
            "material": "cotton",
            "fit": "straight",
            "neckline": "round",
            "pattern": "denim weave",
            "season": "all",
            "sleeve": "none"
        }
    },

    // ==================== headphone (501-1000) ====================
    // Comment: Bose over-ear headphones with Bluetooth 5.4, active noise cancellation, 40h battery life
    {
        "spec_id": "501_ANC_black",
        "product_id": 501,
        "attributes": {
            "brand": "Bose",
            "connection": "Bluetooth 5.4",
            "battery": "40h",
            "noise_cancellation": true,
            "color": "black",
            "driver_size": "40mm",
            "waterproof": "IPX4",
            "controls": "touch"
        }
    },
    // Comment: Bose ANC headphones in white, same technical specs as black version
    {
        "spec_id": "501_ANC_white",
        "product_id": 501,
        "attributes": {
            "brand": "Bose",
            "connection": "Bluetooth 5.4",
            "battery": "40h",
            "noise_cancellation": true,
            "color": "white",
            "driver_size": "40mm",
            "waterproof": "IPX4",
            "controls": "touch"
        }
    },
    // Comment: Sennheiser wired headphones with 3.5mm jack, inline controls, no battery required
    {
        "spec_id": "502_wired_silver",
        "product_id": 502,
        "attributes": {
            "brand": "Sennheiser",
            "connection": "wired (3.5mm)",
            "battery": "no battery",
            "noise_cancellation": false,
            "color": "silver",
            "driver_size": "32mm",
            "waterproof": "no",
            "controls": "inline"
        }
    },
    // Comment: Sennheiser wired headphones in black, identical audio performance to silver model
    {
        "spec_id": "502_wired_black",
        "product_id": 502,
        "attributes": {
            "brand": "Sennheiser",
            "connection": "wired (3.5mm)",
            "battery": "no battery",
            "noise_cancellation": false,
            "color": "black",
            "driver_size": "32mm",
            "waterproof": "no",
            "controls": "inline"
        }
    },

    // ==================== vase (1001-1500) ====================
    // Comment: Minimalist ceramic vase, matte texture, 30cm height, suitable for small bouquets
    {
        "spec_id": "1001_ceramic_round",
        "product_id": 1001,
        "attributes": {
            "material": "ceramic",
            "color": "off-white",
            "height": "30cm",
            "shape": "round",
            "texture": "matte",
            "capacity": "1.2L",
            "style": "minimalist"
        }
    },
    // Comment: Tall cylindrical ceramic vase (50cm), same matte finish, ideal for long-stem flowers
    {
        "spec_id": "1001_ceramic_tall",
        "product_id": 1001,
        "attributes": {
            "material": "ceramic",
            "color": "off-white",
            "height": "50cm",
            "shape": "tall cylindrical",
            "texture": "matte",
            "capacity": "2L",
            "style": "minimalist"
        }
    },
    // Comment: Vintage handblown glass vase, amber color, hourglass shape, smooth texture
    {
        "spec_id": "1002_glass_amber",
        "product_id": 1002,
        "attributes": {
            "material": "handblown glass",
            "color": "amber",
            "height": "25cm",
            "shape": "hourglass",
            "texture": "smooth",
            "capacity": "0.8L",
            "style": "vintage"
        }
    },
    // Comment: Vintage glass vase in emerald green, same hourglass design as amber variant
    {
        "spec_id": "1002_glass_green",
        "product_id": 1002,
        "attributes": {
            "material": "handblown glass",
            "color": "emerald green",
            "height": "25cm",
            "shape": "hourglass",
            "texture": "smooth",
            "capacity": "0.8L",
            "style": "vintage"
        }
    },

    // ==================== electronics (1501-2000) ====================
    // Comment: Samsung smart phone, 6.7-inch AMOLED display, 8GB RAM, 256GB storage, Android OS
    {
        "spec_id": "1501_256GB_black",
        "product_id": 1501,
        "attributes": {
            "brand": "Samsung",
            "type": "smartphone",
            "screen_size": "6.7 inch",
            "display_type": "AMOLED",
            "ram": "8GB",
            "storage": "256GB",
            "os": "Android 14",
            "battery": "5000mAh",
            "warranty": "2 years",
            "color": "black"
        }
    },
    // Comment: Samsung smartphone in white, 512GB storage, same hardware specs as black model
    {
        "spec_id": "1501_512GB_white",
        "product_id": 1501,
        "attributes": {
            "brand": "Samsung",
            "type": "smartphone",
            "screen_size": "6.7 inch",
            "display_type": "AMOLED",
            "ram": "8GB",
            "storage": "512GB",
            "os": "Android 14",
            "battery": "5000mAh",
            "warranty": "2 years",
            "color": "white"
        }
    },
    // Comment: Apple tablet, 10.9-inch Liquid Retina display, 128GB storage, iPadOS
    {
        "spec_id": "1502_128GB_gray",
        "product_id": 1502,
        "attributes": {
            "brand": "Apple",
            "type": "tablet",
            "screen_size": "10.9 inch",
            "display_type": "Liquid Retina",
            "ram": "4GB",
            "storage": "128GB",
            "os": "iPadOS 17",
            "battery": "10 hours",
            "warranty": "1 year",
            "color": "space gray"
        }
    },
    // Comment: Apple tablet in silver, 256GB storage, identical display and performance
    {
        "spec_id": "1502_256GB_silver",
        "product_id": 1502,
        "attributes": {
            "brand": "Apple",
            "type": "tablet",
            "screen_size": "10.9 inch",
            "display_type": "Liquid Retina",
            "ram": "4GB",
            "storage": "256GB",
            "os": "iPadOS 17",
            "battery": "10 hours",
            "warranty": "1 year",
            "color": "silver"
        }
    },

    // ==================== home (2001-2500) ====================
    // Comment: Wooden dining chair, oak material, natural finish, ergonomic design for home use
    {
        "spec_id": "2001_oak_natural",
        "product_id": 2001,
        "attributes": {
            "material": "oak wood",
            "color": "natural",
            "style": "scandinavian",
            "furniture_type": "dining chair",
            "dimension": "45x50x85cm",
            "usage": "indoor",
            "weight_capacity": "120kg",
            "seat_material": "cotton cushion"
        }
    },
    // Comment: Wooden dining chair in walnut finish, same ergonomic structure as natural oak model
    {
        "spec_id": "2001_walnut_brown",
        "product_id": 2001,
        "attributes": {
            "material": "oak wood",
            "color": "walnut brown",
            "style": "scandinavian",
            "furniture_type": "dining chair",
            "dimension": "45x50x85cm",
            "usage": "indoor",
            "weight_capacity": "120kg",
            "seat_material": "cotton cushion"
        }
    },
    // Comment: Linen bed sheet set, queen size, light blue color, breathable fabric
    {
        "spec_id": "2002_queen_blue",
        "product_id": 2002,
        "attributes": {
            "material": "100% linen",
            "color": "light blue",
            "style": "minimalist",
            "furniture_type": "bedding",
            "size": "queen",
            "usage": "bedroom",
            "thread_count": "200",
            "care_instructions": "machine wash cold"
        }
    },
    // Comment: Linen bed sheet set in white, king size, same breathable linen material
    {
        "spec_id": "2002_king_white",
        "product_id": 2002,
        "attributes": {
            "material": "100% linen",
            "color": "white",
            "style": "minimalist",
            "furniture_type": "bedding",
            "size": "king",
            "usage": "bedroom",
            "thread_count": "200",
            "care_instructions": "machine wash cold"
        }
    },

    // ==================== beauty (2501-3000) ====================
    // Comment: Vitamin C serum, 30ml volume, suitable for all skin types, 12-month expiry
    {
        "spec_id": "2501_30ml_all",
        "product_id": 2501,
        "attributes": {
            "brand": "The Ordinary",
            "product_type": "serum",
            "formula": "vitamin C 10%",
            "skin_type": "all",
            "expiry_date": "12 months",
            "volume": "30ml",
            "texture": "liquid",
            "application": "morning",
            "fragrance": "unscented"
        }
    },
    // Comment: Vitamin C serum in 50ml size, formulated for sensitive skin, same brand
    {
        "spec_id": "2501_50ml_sensitive",
        "product_id": 2501,
        "attributes": {
            "brand": "The Ordinary",
            "product_type": "serum",
            "formula": "vitamin C 10%",
            "skin_type": "sensitive",
            "expiry_date": "12 months",
            "volume": "50ml",
            "texture": "liquid",
            "application": "morning",
            "fragrance": "unscented"
        }
    },
    // Comment: Matte lipstick, red shade, long-lasting formula, suitable for combination skin
    {
        "spec_id": "2502_red_matte",
        "product_id": 2502,
        "attributes": {
            "brand": "MAC",
            "product_type": "lipstick",
            "formula": "long-lasting",
            "skin_type": "combination",
            "expiry_date": "24 months",
            "color": "ruby red",
            "finish": "matte",
            "application": "direct",
            "fragrance": "vanilla"
        }
    },
    // Comment: Matte lipstick in nude shade, same long-lasting formula as red variant
    {
        "spec_id": "2502_nude_matte",
        "product_id": 2502,
        "attributes": {
            "brand": "MAC",
            "product_type": "lipstick",
            "formula": "long-lasting",
            "skin_type": "combination",
            "expiry_date": "24 months",
            "color": "taupe nude",
            "finish": "matte",
            "application": "direct",
            "fragrance": "vanilla"
        }
    },

    // ==================== sports (3001-3500) ====================
    // Comment: Men's running shoes, mesh material, size 9, black color, shock-absorbing sole
    {
        "spec_id": "3001_men_9_black",
        "product_id": 3001,
        "attributes": {
            "type": "running shoes",
            "material": "mesh + synthetic",
            "size": "9 US",
            "gender": "men",
            "sport_category": "running",
            "resistance": "none",
            "color": "black",
            "sole_type": "shock-absorbing",
            "waterproof": false
        }
    },
    // Comment: Women's running shoes, size 7, pink color, same mesh material and sole technology
    {
        "spec_id": "3001_women_7_pink",
        "product_id": 3001,
        "attributes": {
            "type": "running shoes",
            "material": "mesh + synthetic",
            "size": "7 US",
            "gender": "women",
            "sport_category": "running",
            "resistance": "none",
            "color": "pink",
            "sole_type": "shock-absorbing",
            "waterproof": false
        }
    },
    // Comment: Yoga mat, 6mm thickness, non-slip surface, blue color, suitable for beginners
    {
        "spec_id": "3002_6mm_blue",
        "product_id": 3002,
        "attributes": {
            "type": "yoga mat",
            "material": "TPE",
            "size": "183x61cm",
            "gender": "unisex",
            "sport_category": "yoga",
            "resistance": "medium",
            "color": "blue",
            "thickness": "6mm",
            "texture": "non-slip"
        }
    },
    // Comment: Yoga mat in green, 8mm thickness, same non-slip TPE material for advanced users
    {
        "spec_id": "3002_8mm_green",
        "product_id": 3002,
        "attributes": {
            "type": "yoga mat",
            "material": "TPE",
            "size": "183x61cm",
            "gender": "unisex",
            "sport_category": "yoga",
            "resistance": "high",
            "color": "green",
            "thickness": "8mm",
            "texture": "non-slip"
        }
    },

    // ==================== books (3501-4000) ====================
    // Comment: Fiction novel, hardcover edition, 350 pages, published by Penguin Random House
    {
        "spec_id": "3501_hardcover_fiction",
        "product_id": 3501,
        "attributes": {
            "title": "The Midnight Library",
            "author": "Matt Haig",
            "genre": "fiction",
            "publisher": "Penguin Random House",
            "pages": "350",
            "edition": "1st",
            "format": "hardcover",
            "publication_year": "2020",
            "language": "English"
        }
    },
    // Comment: Fiction novel in paperback format, same page count and publication details
    {
        "spec_id": "3501_paperback_fiction",
        "product_id": 3501,
        "attributes": {
            "title": "The Midnight Library",
            "author": "Matt Haig",
            "genre": "fiction",
            "publisher": "Penguin Random House",
            "pages": "350",
            "edition": "1st",
            "format": "paperback",
            "publication_year": "2020",
            "language": "English"
        }
    },
    // Comment: Business self-help book, audiobook format, 8 hours runtime, narrated by author
    {
        "spec_id": "3502_audiobook_business",
        "product_id": 3502,
        "attributes": {
            "title": "Atomic Habits",
            "author": "James Clear",
            "genre": "self-help",
            "publisher": "Avery",
            "pages": "320",
            "edition": "revised",
            "format": "audiobook",
            "publication_year": "2018",
            "language": "English",
            "runtime": "8 hours"
        }
    },
    // Comment: Business self-help book in e-book format, compatible with all devices
    {
        "spec_id": "3502_ebook_business",
        "product_id": 3502,
        "attributes": {
            "title": "Atomic Habits",
            "author": "James Clear",
            "genre": "self-help",
            "publisher": "Avery",
            "pages": "320",
            "edition": "revised",
            "format": "e-book",
            "publication_year": "2018",
            "language": "English",
            "compatibility": "all devices"
        }
    },

    // ==================== toys (4001-4500) ====================
    // Comment: Building blocks set, 500 pieces, compatible with major brands, suitable for 6+ years
    {
        "spec_id": "4001_500pcs_6+",
        "product_id": 4001,
        "attributes": {
            "type": "building blocks",
            "age_range": "6+ years",
            "material": "ABS plastic",
            "battery_required": false,
            "interactive": true,
            "theme": "city",
            "piece_count": "500",
            "compatibility": "major brands",
            "color": "multi-color"
        }
    },
    // Comment: Building blocks set with 1000 pieces, space theme, same ABS plastic material
    {
        "spec_id": "4001_1000pcs_8+",
        "product_id": 4001,
        "attributes": {
            "type": "building blocks",
            "age_range": "8+ years",
            "material": "ABS plastic",
            "battery_required": false,
            "interactive": true,
            "theme": "space",
            "piece_count": "1000",
            "compatibility": "major brands",
            "color": "multi-color"
        }
    },
    // Comment: Interactive plush toy, battery-powered, responds to touch, suitable for 3+ years
    {
        "spec_id": "4002_plush_dog",
        "product_id": 4002,
        "attributes": {
            "type": "plush toy",
            "age_range": "3+ years",
            "material": "polyester",
            "battery_required": true,
            "battery_type": "AA x 2",
            "interactive": true,
            "theme": "animal",
            "color": "brown",
            "features": "touch response, barking sound"
        }
    },
    // Comment: Interactive plush cat toy, same battery requirement and touch response features
    {
        "spec_id": "4002_plush_cat",
        "product_id": 4002,
        "attributes": {
            "type": "plush toy",
            "age_range": "3+ years",
            "material": "polyester",
            "battery_required": true,
            "battery_type": "AA x 2",
            "interactive": true,
            "theme": "animal",
            "color": "gray",
            "features": "touch response, meowing sound"
        }
    },

    // ==================== automotive (4501-5000) ====================
    // Comment: Oil filter for petrol SUVs (2018+), screw-on installation, 99% filtration efficiency
    {
        "spec_id": "4501_filter_petrol",
        "product_id": 4501,
        "attributes": {
            "part_type": "oil filter",
            "compatibility": "SUVs 2018+",
            "fuel_type": "petrol",
            "material": "paper + metal",
            "installation_type": "screw-on",
            "warranty": "1 year",
            "filtration_efficiency": "99%",
            "weight": "200g",
            "dimensions": "7x10cm"
        }
    },
    // Comment: Oil filter for diesel trucks (2015+), same material and installation type
    {
        "spec_id": "4501_filter_diesel",
        "product_id": 4501,
        "attributes": {
            "part_type": "oil filter",
            "compatibility": "trucks 2015+",
            "fuel_type": "diesel",
            "material": "paper + metal",
            "installation_type": "screw-on",
            "warranty": "1 year",
            "filtration_efficiency": "99%",
            "weight": "350g",
            "dimensions": "9x12cm"
        }
    },
    // Comment: Car phone mount, air vent installation, compatible with all smartphones
    {
        "spec_id": "4502_mount_vent",
        "product_id": 4502,
        "attributes": {
            "part_type": "phone mount",
            "compatibility": "all smartphones",
            "material": "ABS plastic + silicone",
            "installation_type": "air vent",
            "warranty": "2 years",
            "adjustable": true,
            "rotation": "360°",
            "color": "black",
            "max_phone_width": "8cm"
        }
    },
    // Comment: Car phone mount with dashboard installation, same adjustability and compatibility
    {
        "spec_id": "4502_mount_dashboard",
        "product_id": 4502,
        "attributes": {
            "part_type": "phone mount",
            "compatibility": "all smartphones",
            "material": "ABS plastic + silicone",
            "installation_type": "dashboard",
            "warranty": "2 years",
            "adjustable": true,
            "rotation": "360°",
            "color": "black",
            "max_phone_width": "8cm"
        }
    }
]);

print("Product specifications inserted: " + db.product_specs.countDocuments({}));

// Create indexes for product_specs collection
db.product_specs.createIndex({ "product_id": 1 });
db.product_specs.createIndex({ "spec_id": 1 }, { unique: true });
db.product_specs.createIndex({ "attributes.brand": 1 });
db.product_specs.createIndex({ "attributes.color": 1 });

print("Indexes created for product_specs collection");

// ====================
// SWITCH TO EVENTS DATABASE
// ====================

use('ecommerce_events');

// Drop existing collections (optional - uncomment if needed)
// db.user_events.drop();
// db.cart_sessions.drop();

// ====================
// USER EVENTS COLLECTION
// Collection: user_events
// ====================

db.user_events.insertMany([
    // User 1001 Events
    {
        "user_id": 1001,
        "session_id": 100001,
        "event_type": "view",
        "product_id": 12345,
        "search_term": null,
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T08:15:00Z"),
        "page_url": "/products/12345",
        "referrer": "google.com"
    },
    {
        "user_id": 1001,
        "session_id": 100001,
        "event_type": "view",
        "product_id": 23456,
        "search_term": null,
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T08:20:00Z"),
        "page_url": "/products/23456",
        "referrer": null
    },
    {
        "user_id": 1001,
        "session_id": 100001,
        "event_type": "add_to_cart",
        "product_id": 12345,
        "search_term": null,
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T08:25:00Z"),
        "spec_id": "12345_S_blue",
        "quantity": 2
    },
    {
        "user_id": 1001,
        "session_id": 100001,
        "event_type": "search",
        "product_id": null,
        "search_term": "ceramic vase",
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T08:30:00Z"),
        "results_count": 12
    },

    // User 1002 Events  
    {
        "user_id": 1002,
        "session_id": 100002,
        "event_type": "search",
        "product_id": null,
        "search_term": "bluetooth headphones",
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T09:20:00Z"),
        "results_count": 25
    },
    {
        "user_id": 1002,
        "session_id": 100002,
        "event_type": "view",
        "product_id": 67890,
        "search_term": null,
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T09:25:00Z"),
        "page_url": "/products/67890",
        "referrer": "/search"
    },
    {
        "user_id": 1002,
        "session_id": 100002,
        "event_type": "add_to_cart",
        "product_id": 67890,
        "search_term": null,
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T09:30:00Z"),
        "spec_id": "67890_BT53",
        "quantity": 1
    },
    {
        "user_id": 1002,
        "session_id": 100002,
        "event_type": "purchase",
        "product_id": 67890,
        "search_term": null,
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T09:45:00Z"),
        "order_id": 20001,
        "amount": 299.99
    },

    // User 1003 Events
    {
        "user_id": 1003,
        "session_id": 100003,
        "event_type": "search",
        "product_id": null,
        "search_term": "running shoes",
        "device_type": "tablet",
        "timestamp": new Date("2025-11-20T10:35:00Z"),
        "results_count": 42
    },
    {
        "user_id": 1003,
        "session_id": 100003,
        "event_type": "view",
        "product_id": 34567,
        "search_term": null,
        "device_type": "tablet",
        "timestamp": new Date("2025-11-20T10:40:00Z"),
        "page_url": "/products/34567",
        "referrer": "/search"
    },
    {
        "user_id": 1003,
        "session_id": 100003,
        "event_type": "view",
        "product_id": 45678,
        "search_term": null,
        "device_type": "tablet",
        "timestamp": new Date("2025-11-20T10:50:00Z"),
        "page_url": "/products/45678",
        "referrer": null
    },
    {
        "user_id": 1003,
        "session_id": 100003,
        "event_type": "add_to_cart",
        "product_id": 34567,
        "search_term": null,
        "device_type": "tablet",
        "timestamp": new Date("2025-11-20T11:00:00Z"),
        "spec_id": "34567_L_red",
        "quantity": 1
    },

    // Guest User Events (session-based)
    {
        "user_id": null,
        "session_id": 200001,
        "event_type": "search",
        "product_id": null,
        "search_term": "t-shirt",
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T08:35:00Z"),
        "results_count": 156
    },
    {
        "user_id": null,
        "session_id": 200001,
        "event_type": "view",
        "product_id": 12345,
        "search_term": null,
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T08:40:00Z"),
        "page_url": "/products/12345",
        "referrer": "/search"
    },
    {
        "user_id": null,
        "session_id": 200002,
        "event_type": "search",
        "product_id": null,
        "search_term": "smart tv",
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T10:05:00Z"),
        "results_count": 24
    },
    {
        "user_id": null,
        "session_id": 200002,
        "event_type": "view",
        "product_id": 78901,
        "search_term": null,
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T10:10:00Z"),
        "page_url": "/products/78901",
        "referrer": "/search"
    },

    // Additional Events for Analytics
    {
        "user_id": 1004,
        "session_id": 100004,
        "event_type": "view",
        "product_id": 56789,
        "search_term": null,
        "device_type": "desktop",
        "timestamp": new Date("2025-11-20T12:00:00Z"),
        "page_url": "/products/56789",
        "referrer": "facebook.com"
    },
    {
        "user_id": 1005,
        "session_id": 100005,
        "event_type": "click",
        "product_id": 78901,
        "search_term": null,
        "device_type": "mobile",
        "timestamp": new Date("2025-11-20T13:30:00Z"),
        "element": "product_image",
        "page_url": "/category/electronics"
    },
    {
        "user_id": 1006,
        "session_id": 100006,
        "event_type": "view",
        "product_id": 89012,
        "search_term": null,
        "device_type": "smart_tv",
        "timestamp": new Date("2025-11-20T14:45:00Z"),
        "page_url": "/products/89012",
        "referrer": null
    }
]);

print("User events inserted: " + db.user_events.countDocuments({}));

// Create indexes for user_events collection
db.user_events.createIndex({ "user_id": 1, "timestamp": -1 });
db.user_events.createIndex({ "session_id": 1, "timestamp": -1 });
db.user_events.createIndex({ "product_id": 1, "event_type": 1 });
db.user_events.createIndex({ "event_type": 1, "timestamp": -1 });
db.user_events.createIndex({ "device_type": 1 });
db.user_events.createIndex({ "timestamp": -1 });

print("Indexes created for user_events collection");

// ====================
// CART SESSIONS COLLECTION
// Collection: cart_sessions
// ====================

db.cart_sessions.insertMany([
    {
        "cart_id": 5001,
        "session_id": 100001,
        "user_id": 1001,
        "items": [
            {
                "product_id": 12345,
                "spec_id": "12345_S_blue",
                "quantity": 2,
                "added_at": new Date("2025-11-20T08:25:00Z"),
                "price_at_add": 29.99
            },
            {
                "product_id": 23456,
                "spec_id": "23456_ceramic",
                "quantity": 1,
                "added_at": new Date("2025-11-20T08:35:00Z"),
                "price_at_add": 89.99
            }
        ],
        "created_at": new Date("2025-11-20T08:25:00Z"),
        "last_updated": new Date("2025-11-20T08:35:00Z"),
        "is_converted_to_order": false,
        "order_id": null,
        "device_type": "desktop",
        "total_value": 149.97,
        "currency": "USD"
    },
    {
        "cart_id": 5002,
        "session_id": 100002,
        "user_id": 1002,
        "items": [
            {
                "product_id": 67890,
                "spec_id": "67890_BT53",
                "quantity": 1,
                "added_at": new Date("2025-11-20T09:30:00Z"),
                "price_at_add": 299.99
            }
        ],
        "created_at": new Date("2025-11-20T09:30:00Z"),
        "last_updated": new Date("2025-11-20T09:30:00Z"),
        "is_converted_to_order": true,
        "order_id": 20001,
        "device_type": "mobile",
        "total_value": 299.99,
        "currency": "USD",
        "converted_at": new Date("2025-11-20T09:45:00Z")
    },
    {
        "cart_id": 5003,
        "session_id": 100003,
        "user_id": 1003,
        "items": [
            {
                "product_id": 34567,
                "spec_id": "34567_L_red",
                "quantity": 1,
                "added_at": new Date("2025-11-20T11:00:00Z"),
                "price_at_add": 129.99
            },
            {
                "product_id": 45678,
                "spec_id": "45678_XL_black",
                "quantity": 2,
                "added_at": new Date("2025-11-20T11:30:00Z"),
                "price_at_add": 45.99
            }
        ],
        "created_at": new Date("2025-11-20T11:00:00Z"),
        "last_updated": new Date("2025-11-20T11:30:00Z"),
        "is_converted_to_order": false,
        "order_id": null,
        "device_type": "tablet",
        "total_value": 221.97,
        "currency": "USD"
    },
    {
        "cart_id": 6001,
        "session_id": 200001,
        "user_id": null,
        "items": [
            {
                "product_id": 12345,
                "spec_id": "12345_L_black",
                "quantity": 1,
                "added_at": new Date("2025-11-20T08:45:00Z"),
                "price_at_add": 29.99
            }
        ],
        "created_at": new Date("2025-11-20T08:45:00Z"),
        "last_updated": new Date("2025-11-20T08:45:00Z"),
        "is_converted_to_order": false,
        "order_id": null,
        "device_type": "mobile",
        "total_value": 29.99,
        "currency": "USD"
    },
    {
        "cart_id": 6002,
        "session_id": 200002,
        "user_id": null,
        "items": [
            {
                "product_id": 67890,
                "spec_id": "67890_BT53",
                "quantity": 1,
                "added_at": new Date("2025-11-20T10:15:00Z"),
                "price_at_add": 299.99
            },
            {
                "product_id": 23456,
                "spec_id": "23456_ceramic",
                "quantity": 1,
                "added_at": new Date("2025-11-20T10:25:00Z"),
                "price_at_add": 89.99
            }
        ],
        "created_at": new Date("2025-11-20T10:15:00Z"),
        "last_updated": new Date("2025-11-20T10:25:00Z"),
        "is_converted_to_order": false,
        "order_id": null,
        "device_type": "desktop",
        "total_value": 389.98,
        "currency": "USD"
    }
]);

print("Cart sessions inserted: " + db.cart_sessions.countDocuments({}));

// Create indexes for cart_sessions collection
db.cart_sessions.createIndex({ "cart_id": 1 }, { unique: true });
db.cart_sessions.createIndex({ "session_id": 1 });
db.cart_sessions.createIndex({ "user_id": 1 });
db.cart_sessions.createIndex({ "is_converted_to_order": 1, "created_at": -1 });
db.cart_sessions.createIndex({ "created_at": -1 });
db.cart_sessions.createIndex({ "last_updated": -1 });

print("Indexes created for cart_sessions collection");

// ====================
// AGGREGATION EXAMPLES AND VIEWS
// ====================

// Create view for popular products
db.createView("popular_products", "user_events", [
    { $match: { "event_type": "view" } },
    { $group: {
        _id: "$product_id",
        view_count: { $sum: 1 },
        unique_users: { $addToSet: "$user_id" },
        last_viewed: { $max: "$timestamp" }
    }},
    { $addFields: {
        unique_user_count: { $size: "$unique_users" }
    }},
    { $project: {
        product_id: "$_id",
        view_count: 1,
        unique_user_count: 1,
        last_viewed: 1,
        _id: 0
    }},
    { $sort: { view_count: -1 } }
]);

// Create view for conversion funnel
db.createView("conversion_funnel", "cart_sessions", [
    { $group: {
        _id: null,
        total_carts: { $sum: 1 },
        converted_carts: { $sum: { $cond: ["$is_converted_to_order", 1, 0] } },
        total_cart_value: { $sum: "$total_value" },
        converted_value: { 
            $sum: { 
                $cond: ["$is_converted_to_order", "$total_value", 0] 
            }
        }
    }},
    { $project: {
        _id: 0,
        total_carts: 1,
        converted_carts: 1,
        conversion_rate: { 
            $divide: ["$converted_carts", "$total_carts"] 
        },
        total_cart_value: 1,
        converted_value: 1,
        value_conversion_rate: {
            $divide: ["$converted_value", "$total_cart_value"]
        }
    }}
]);

// ====================
// VERIFICATION QUERIES
// ====================

print("=== DATABASE SUMMARY ===");
print("Product Specs Count: " + db.runCommand("collStats", {"collection": "product_specs", "count": 1}).count);
print("User Events Count: " + db.user_events.countDocuments({}));
print("Cart Sessions Count: " + db.cart_sessions.countDocuments({}));

print("\n=== SAMPLE QUERIES ===");
print("Sample Product Spec:");
printjson(db.product_specs.findOne({"product_id": 12345}));

print("\nRecent User Events (last 5):");
db.user_events.find({}).sort({"timestamp": -1}).limit(5).forEach(printjson);

print("\nActive Cart Sessions:");
db.cart_sessions.find({"is_converted_to_order": false}).forEach(printjson);

print("\nConversion Statistics:");
db.conversion_funnel.find({}).forEach(printjson);

print("\n=== INDEXES CREATED ===");
print("product_specs indexes:");
printjson(db.product_specs.getIndexes());

print("user_events indexes:");
printjson(db.user_events.getIndexes());

print("cart_sessions indexes:");
printjson(db.cart_sessions.getIndexes());